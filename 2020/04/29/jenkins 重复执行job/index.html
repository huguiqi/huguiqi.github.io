
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
  <meta name="keywords" content="胡小黑,架构师,资深软件工程师,object-c,swift,java,node,小黑,技术,大牛,阿里巴巴,腾讯,旅游">
  
  
    <title>jenkins 重复执行job | 小黑的技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="sam">
    
    <meta name="baidu-site-verification" content="zBj0BDqjSV" />
    
    <meta name="description" content="jenkins 重复执行jobjenkins配置全过程  \         Jenkins使用经验谈4（创建Job）          前面做了那么多工作，现在终于到了创建Job这一步了，某种意义上，Jenkins的主要工作就是为了调度这些Job。Job的创建是有很大自由度的，也没有谁规定一定要创建成什么样子才行。下面我会以实际使用中的几个场景来举例说明。需要注意的是：  Job名称千万不要用中">
<meta property="og:type" content="article">
<meta property="og:title" content="jenkins 重复执行job">
<meta property="og:url" content="http://clockcoder.com/2020/04/29/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob/index.html">
<meta property="og:site_name" content="小黑的技术博客">
<meta property="og:description" content="jenkins 重复执行jobjenkins配置全过程  \         Jenkins使用经验谈4（创建Job）          前面做了那么多工作，现在终于到了创建Job这一步了，某种意义上，Jenkins的主要工作就是为了调度这些Job。Job的创建是有很大自由度的，也没有谁规定一定要创建成什么样子才行。下面我会以实际使用中的几个场景来举例说明。需要注意的是：  Job名称千万不要用中">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909061.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909062.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909063.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909064.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909065.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909066.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909067.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909068.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909069.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090610.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090611.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090612.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090613.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090614.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090615.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090616.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090617.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090618.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090619.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090620.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090621.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090622.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090623.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090624.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090625.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090626.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090627.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090628.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090629.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090630.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090631.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090632.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090633.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090634.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090635.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090636.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090637.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090638.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090639.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090640.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090641.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090642.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090643.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090644.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090645.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090646.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090647.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090648.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090649.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090650.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090651.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090652.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090653.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090654.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090655.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090656.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090657.png">
<meta property="og:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090658.png">
<meta property="article:published_time" content="2020-04-28T16:00:00.000Z">
<meta property="article:modified_time" content="2023-02-16T11:41:07.559Z">
<meta property="article:author" content="sam">
<meta property="article:tag" content="从印象笔记导入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://clockcoder.com/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909061.png">
<meta name="twitter:creator" content="@XiaoheiSpring">
<link rel="publisher" href="109318125124422212783">

    
    <link rel="alternative" href="/atom.xml" title="小黑的技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7265659350794760"
     crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
      
<div>

		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="小黑的技术博客" title="小黑的技术博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="小黑的技术博客">小黑的技术博客</a></h1>
				<h2 class="blog-motto">不积跬步无以至千里</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li><a href="http://clockcoder.com">副站</a></li>
					<li>
 					
						<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="on" class="st-default-search-input"  name="q" maxlength="30" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/04/29/jenkins 重复执行job/" title="jenkins 重复执行job" itemprop="url">jenkins 重复执行job</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2020-04-28T16:00:00.000Z" itemprop="datePublished"> 发表于 2020-04-29</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins-%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob"><span class="toc-number">1.</span> <span class="toc-text">jenkins 重复执行job</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jenkins%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C%E8%B0%884%EF%BC%88%E5%88%9B%E5%BB%BAJob%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Jenkins使用经验谈4（创建Job）</span></a></li></ol>
		
		</div>
		
		<h1 id="jenkins-重复执行job"><a title="jenkins 重复执行job" class="headerlink" href="#jenkins-重复执行job"></a>jenkins 重复执行job</h1><p>jenkins配置全过程</p>
<hr>
<p>\</p>
<div>

<div>

<div>

<div>

<h1 id="Jenkins使用经验谈4（创建Job）"><a title="Jenkins使用经验谈4（创建Job）" class="headerlink" href="#Jenkins使用经验谈4（创建Job）"></a>Jenkins使用经验谈4（创建Job）</h1><div>

<div>

</div>

</div>

</div>

<p>前面做了那么多工作，现在终于到了创建Job这一步了，某种意义上，Jenkins的主要工作就是为了调度这些Job。Job的创建是有很大自由度的，也没有谁规定一定要创建成什么样子才行。下面我会以实际使用中的几个场景来举例说明。<br>需要注意的是：</p>
<ul>
<li>Job名称千万不要用中文名称（不作死就不会死）。</li>
<li>创建Job名称时最好有个规划，因为我们最后会通过正则匹配自动将Job归类，比如我喜欢<br>“<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E9%A1%B9%E7%9B%AE-0.html">项目</a>前缀_一些说明-Job类型”这种方式。</li>
</ul>
<p><strong>先做一些准备活动</strong>\</p>

<p><br>为了方便我们后面的实验，先找一台<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E8%99%9A%E6%8B%9F%E6%9C%BA-0.html">虚拟机</a>，在上面搭建一下git<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E6%9C%8D%E5%8A%A1%E5%99%A8-0.html">服务器</a>和<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">代码</a>质量管理平台（我这里使用的是sonar）。<br><br><strong>搭建git服务器</strong><br><br>因这部分不是我们的重点，所以我打算搭建一个最简单的基于SSH的git服务器，假设这台服务器IP为<br>172.16.12.83。<br>首选先从 <a target="_blank" rel="noopener" href="https://github.com/git/git/tarball/master">https://github.com/git/git/tarball/master</a><br>下载git代码，按照下面的步骤解压并安装。<br>    [root svr83 ~]# tar xzvf git-git-v1.8.4-474-g128a96c.tar.gz -C /usr/local/src/[root svr83 ~]# cd /usr/local/src/git-git-128a96c/[root svr83 git-git-128a96c]# autoconf &amp;&amp; ./configure –prefix=/usr/[root svr83 git-git-128a96c]# make &amp;&amp; make install</p>
<p><br><br>创建一个git用户并以登录到这个git用户，然后在该用户的家目录下创建一个<br>git_home 用于存放项目代码（暂时先给git用户设置密码为git）。<br>    [root svr83 ~]# useradd git[root svr83 ~]# passwd gitChanging password for user git.New UNIX password: BAD PASSWORD: it is WAY too shortRetype new UNIX password: passwd: all authentication tokens updated successfully.[root svr83 ~]# su - git[git svr83 ~]$ mkdir git_home</p>
<p><br><br>我们现在在 /tmp 下创建一个git 本地库，比如叫<br>hello<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-Java-0.html">Java</a>，然后向这个库里提交一个<br>readme.txt 文件（因为第一次使用git，还需要设置一下用户名和邮件地址）。<br>    [git svr83 helloJava]$ git config –global user.email “bookong gmail.com”[git svr83 helloJava]$ git config –global user.name “jiangxu”[git svr83 ~]$ mkdir /tmp/helloJava[git svr83 ~]$ cd /tmp/helloJava/[git svr83 helloJava]$ git init初始化空的 Git 版本库于 /tmp/helloJava/.git/[git svr83 helloJava]$ echo “hello java project” &gt; readme.txt[git svr83 helloJava]$ git add *[git svr83 helloJava]$ git commit -m ‘initial project’[master（根提交） d605f94] initial project 1 file changed, 1 insertion(+) create mode 100644 readme.txt</p>
<p><br><br>将隐藏的 .git 目录拷贝到 /home/git/git_home 下，并改名叫 helloJava.git<br>目录。<br>    [git svr83 helloJava]$ cp -a .git/ /home/git/git_home/helloJava.git</p>
<p><br><br>我们在另一台服务器上试着clone出helloJava 项目。<br>    [jenkins svr82 test]$ git clone ssh://git 172.16.12.83/home/git/git_home/helloJava.git正克隆到 ‘helloJava’…The authenticity of host ‘172.16.12.83 (172.16.12.83)’ can’t be established.RSA key fingerprint is 50:51:8e:ad:e0:da:1d:61:fb:d0:97:c0:2b:46:65:83.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added ‘172.16.12.83’ (RSA) to the list of known hosts.git 172.16.12.83’s password: remote: Counting objects: 3, done.remote: Total 3 (delta 0), reused 0 (delta 0)接收对象中: 100% (3/3), done.检查连接… 完成[jenkins svr82 test]$ cat helloJava/readme.txt hello java project</p>
<p><br><br>简陋的 git 服务器搭建好了，足够我们实验用的了。<br><br>**奴隶节点安装git<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E7%A8%8B%E5%BA%8F-0.html">程序</a>**<br><br>之前的文章中，我们创建了两个奴隶节点，<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-0.html">操作系统</a>分表为<br>Win7 和<br>CentOS。现在我们分表在上面安装git<a target="_blank" rel="noopener" href="http://www.07net01.com/ruanjiantuijian/">软件</a>。CentOS这个节点的安装方法上面已经介绍了，只要再照做一遍就可以。Win7<br>下需要安装 msysgit 软件 <a target="_blank" rel="noopener" href="http://msysgit.github.io/%E3%80%82/">http://msysgit.github.io/。\</a><br>到<br><a href="https://code.[Google](http://www.07net01.com/tags-Google-0.html).com/p/msysgit/downloads/list?q=full+installer+official+git">https://code.[Google](http://www.07net01.com/tags-Google-0.html).com/p/msysgit/downloads/list?q=full+installer+official+git</a><br>下载一个最新的程序，比如我下载的是<br>Git-1.8.4-preview20130916.exe，安装时在下图所示步骤里，选择“Run Git from<br>the <a target="_blank" rel="noopener" href="http://www.07net01.com/">Windows</a><br><a target="_blank" rel="noopener" href="http://www.07net01.com/tags-command-0.html">command</a><br>Prompt”，将git添加到PATH路径中，其他都选默认值。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909061.png"></p>
</div>

<p>安装后检查一下</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909062.png"></p>
</div>

<p><strong><a target="_blank" rel="noopener" href="http://www.07net01.com/r_s/">配置</a>访问git服务器的凭据</strong><br><br>还记得我们在上一集里配置了访问CentOS 奴隶节点的凭据吗？<br>用相似的方法在git服务器上给git用户添加一个公钥（具体步骤就不重复了），然后将私钥文件（id_rsa）分别拷贝到两台奴隶节点的当前用户家目录下的<br>.ssh<br>下（要注意在<a target="_blank" rel="noopener" href="http://www.07net01.com/2015/07/873186.html">Linux</a>系统下这个文件的权限必须是600）</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909063.png"></p>
</div>

<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909064.png"></p>
</div>

<p><strong>搭建一个sonar服务器</strong><br><br>为方便实验，我们把sonar搭建在git服务器上（172.16.12.83）。<br>首选到 <a target="_blank" rel="noopener" href="http://www.sonarqube.org/downloads/">http://www.sonarqube.org/downloads/</a> 下载最新的SonarQube。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909065.png"></p>
</div>

<p>解压到 /usr/local/ 下<br>    [root svr83 ~]# mv sonar-3.7.2.zip /usr/local/[root svr83 ~]# cd /usr/local/[root svr83 local]# unzip sonar-3.7.2.zip</p>
<p><br><br>虽然Sonar可以使用默认的H2嵌入<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E6%95%B0%E6%8D%AE%E5%BA%93-0.html">数据库</a>，但Jenkins上的Sonar插件不支持，所以这里我们要安装一个<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-mysql-0.html">mysql</a>的<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">数据库</a><br>我们到下载一个 MySQL，我下的是<br>MySQL-client-5.5.29-1.<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-Linux-0.html">Linux</a>2.6.i386.rpm<br>和<br>MySQL-server-5.5.29-1.<a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">linux</a>2.6.x86_64.rpm。<br>下载链接：<a href="http://dev.[mysql](http://www.07net01.com/program/).com/downloads/[mysql](http://www.07net01.com/program/)/5.5.html\#downloads\">http://dev.[mysql](http://www.07net01.com/program/).com/downloads/[mysql](http://www.07net01.com/program/)/5.5.html\#downloads\</a><br>安装这两个 RPM 包。<br>    [root svr83 sonar-3.7.2]# rpm -ivh MySQL-*</p>
<p><br><br>拷贝模版文件构造 my.cnf。<br>    [root svr83 sonar-3.7.2]# cp /usr/share/mysql/my-medium.cnf /etc/my.cnf</p>
<p><br><br>修改 my.cnf 内容<br>    …[client]…default-character-set = utf8…[mysqld]…lower_case_table_names = 0…</p>
<p><br><br>启动 mysql<br>    [root svr83 sonar-3.7.2]# service mysql start</p>
<p><br><br>进入 mysql<br><a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E5%AE%A2%E6%88%B7%E7%AB%AF-0.html">客户端</a>创建默认的库sonar，添加访问用户（用户名sonar，密码sonar），并退出<br>mysql 客户端。<br>    [root svr83 sonar-3.7.2]# mysqlmysql&gt; grant all privileges name=”code”&gt;[root svr83 sonar-3.7.2]# mysql -h localhost -u sonar -p</p>
<p><br><br>修改 sonar 目录下 conf/sonar.properties 文件，启用 MySQL 相关设置<br>    ……#—– MySQL 5.x# Comment the embedded database and uncomment the following line to use MySQLsonar.jdbc.url:                            jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true……</p>
<p><br><br>启动sonar。<br>    [root svr83 linux-x86-64]# pwd/usr/local/sonar-3.7.2/bin/linux-x86-64[root svr83 linux-x86-64]# ./sonar.sh startStarting sonar…Started sonar.</p>
<p><br><br>在<a target="_blank" rel="noopener" href="http://www.07net01.com/2015/07/873186.html">浏览器</a>中输入<br><a target="_blank" rel="noopener" href="http://172.16.12.83:9000/">http://172.16.12.83:9000/</a> 看到 sonar 的界面。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909066.png"></p>
</div>

<p><strong>创建一个用于健康检查的Job</strong><br><br>我们打算创建这样一个Job，每十五分钟检查一次代码库，发现有提交动作就触发构建，<a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">编译</a>代码并执行单元测试，它的目的是保证构建的完整性。在这个例子里，我们假设代码是Java语言编写，需要JDK<br>7来<a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">编译</a>，使用ant工具来编译执行单元测试，需要在Win<br>7 系统上来做这一切。<br>首选我们先进入Jenkins页面中的“系统管理”→“系统设置”，找到<br>“JDK”部分，选择“新增JDK”。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909067.png"></p>
</div>

<p>我们选择让Jenkins系统在需要的时候自动安装“Java SE Development Kit<br>7u40”。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909068.png"></p>
</div>

<p>注意最下面的错误提示，需要你输入一个<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-Oracle-0.html">Oracle</a><br>帐号，点击链接进去，是一个需要输入帐号和密码的页面（帐号可以到<br><a href="https://login.[oracle](http://www.07net01.com/program/).com/mysso/signon.jsp">https://login.[oracle](http://www.07net01.com/program/).com/mysso/signon.jsp</a><br>免费注册）。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/1411030081909069.png"></p>
</div>

<p>设置好JDK后，我们找到“Ant”部分，点击“新增Ant”按钮。也同样设置在构建需要时自动安装Ant。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090610.png"></p>
</div>

<p>作为这一切后，点击屏幕下方的“Save”按钮保存配置。<br>然后我们写个简单的，用Ant编译的Java小程序，javaAntSample<br>推送到之前搭建好的git服务器上（具体方法参考前面关于git服务器部分的说明）。在这个程序的<br>build.xml 里，我们主要想执行 testrun&nbsp; 这个<br>target，它会完成编译并执行单元测试的工作，最后在项目根路径下产JUnit单元测试的报告<br>TEST-sample.project1.AllTests.xml。<br>现在回到Jenkins的首页，点击“新Job”。使用Ant编译的话我们要选择“构建一个自由风格的软件项目”；“任务名称”我写的是“project1_javaAntSample-auto”，这个名字里我想表达说这个Job属于“project1”项目，之后我建立视图时会用正则匹配所有以“project1_”开头的项目；后面的“javaAntSample”希望我直接查看操作目录时有比较直观的提示，我希望用最后的“auto”标明这是一个做监控检查的Job。当然你也可以采用其他的命名规则。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090611.png"></p>
</div>

<p>确定以后涉及的内容比较多，我一点一点来介绍。<br>首选“描述”这部分很好理解，当你点击进入某个Job查看详情时，会显示在页面的上方，这个部分可以在里面写HTML内容。<br>下面的“丢弃旧的构建”很重要，我们曾经遇到过使用的太久后无用的发布包（比如WAR包）将磁盘<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E7%A9%BA%E9%97%B4-0.html">空间</a>耗尽的情况。我建议这里设置“发布包最大保留#个构建”设置为1。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090612.png"></p>
</div>

<p>后面的几项我一般不做设置，但“Restrict where this project can be<br>run”要设置希望构建的奴隶节点，我们这里设置为 win。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090613.png"><br><br>“高级项目选项”这里，我一般只设置 “Display<br>Name”，这里设置一个中文名称后，在Jenkins里显示Job时优先显示这个值。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090614.png"></p>
</div>

<p>下面就到了“<a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">源码</a>管理”这部分了，选择“Git”，填写仓库的URL和希望签出的分支名。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090615.png"></p>
</div>

<p>你可能注意到了，下面有一大串错误提示“Fail to connect to<br>repository……”这个不用管它，因为Jenkins的主节点我们没有配置访问git服务器的密钥的原因。<br>如果你在Job执行时出现下面错误</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090616.png"></p>
</div>

<p>点击“高级”按钮，我们在下面的地方随便设置一下（可以设置一个<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E7%AE%A1%E7%90%86%E5%91%98-0.html">管理员</a>的邮箱）。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090617.png"><br><br>下面的“构建触发器”部分，我们希望是每15分钟检查一次代码库，如果有变化，则触发构建。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090618.png"></p>
</div>

<p>在下面的“构建”部分，点击按钮“增加构建步骤”，选择“Invoke Ant”。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090619.png"><br><br>Ant的版本选择我们一开始在“系统设置”里指定的版本，第一次执行前它会自己下载。“Targets”输入“testrun”，这个值来自我们的build.xml文件中的定义。<br>在下面的“构建后操作”中，点击“Add post-build<br>action”按钮，在列表中选择“Publish JUnit test result report”。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090620.png"></p>
</div>

<p>由于我们的报告是输出到项目根路径下，所以我们这里直接填写XML文件名。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090621.png"></p>
</div>

<p>现在再次点击“Add post-build action”按钮，选择“E-mail<br>Notification”，添加失败后的邮件提醒。这里不但可以设定固定通知的人，还可以自动发邮件给疑似导致构建失败的人。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090622.png"></p>
</div>

<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090623.png"></p>
</div>

<p>如果你有时间就等待它自动触发构建，否则你可以点击<img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090624.png">直接触发构建</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090625.png"></p>
</div>

<p>这时候你执行Job的构建会发现一直停留在git签出代码阶段，造成这个的原因是家目录不正确，没有找到私钥的原因。我们可以有两个方式解决。<br><br><strong>解决Win7下无法签出git代码</strong><br><br><strong>方式一：修改Win7奴隶节点的设置</strong><br><br>添加两个环境变量“HOMEPATH”和“USERPROFILE”。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090626.png"></p>
</div>

<p><strong>方法二：安装插件 EnvInject Plugin</strong><br><br>我们在插件管理页面中，安装插件“EnvInject Plugin”。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090627.png"><br><br><br>这时再修改Job的定义（在“参数化构建过程”下面会出现新的属性“Prepare an<br>environment for the run”。设置里面的“Properties Content”</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090628.png"></p>
</div>

<p><strong>最后执行结果</strong></p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090629.png"></p>
</div>

<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090630.png"></p>
</div>

<p><strong>创建一个用于代码质量分析的Job</strong><br><br>假如我们希望对代码进行静态检查，可以创建这种Job。最简单的方式就是与sonar进行集成，sonar支持众多语音的静态检查，包括：.NET（$）、<a target="_blank" rel="noopener" href="http://www.07net01.com/">android</a>、C/<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">C++</a>（$）、<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">C++</a>（社区版）、Java、<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-javascript-0.html">javascript</a>、<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">PHP</a>等等，其中后面带（$）表示收费版本，比如C/C++<br>插件一年7000欧元。<a target="_blank" rel="noopener" href="http://docs.codehaus.org/display/SONAR/Plugin+Library/">http://docs.codehaus.org/display/SONAR/Plugin+Library\</a><br>使用前我们先安装Sonar插件“Jenkins Sonar Plugin”<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090631.png"><br><br>安装好插件后，我们进入“系统设置”页面。<br>先找到“Sonar Runner”这里，点击“新增 Sonar Runner”按钮。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090632.png"></p>
</div>

<p>向下，找到“Maven”部分，新建一个Maven（就像前面创建的Ant一样，需要时他会自动安装的）</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090633.png"></p>
</div>

<p>再向下，找到“Sonar”部分，点击“Add Sonar”按钮。其中“Server<br>URL”就是我们Sonar的访问URL“<a target="_blank" rel="noopener" href="http://172.16.12.83:9000/%E2%80%9D%EF%BC%9BSonar%E9%BB%98%E8%AE%A4%E5%B8%90%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81%E9%83%BD%E6%98%AF%E2%80%9Cadmin%E2%80%9D%EF%BC%9B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%83%A8%E5%88%86%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E5%89%8D%E9%9D%A2%E9%85%8D%E7%BD%AESonar[%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6](http://www.07net01.com/tags-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-0.html)%E4%B8%AD%E5%86%99%E7%9A%84MySQL%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE%E3%80%82">http://172.16.12.83:9000/”；Sonar默认帐号和密码都是“admin”；数据库部分的设置就是我们前面配置Sonar[配置文件](http://www.07net01.com/tags-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-0.html)中写的MySQL相关设置。</a></p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090634.png"></p>
</div>

<p>前一个Job里，我们用Ant构建了一个Java项目，毕竟Ant已经过时了，我们在这个Job试试用Maven构建一个项目，先创建一个用Maven构建的项目<br>javaMavenSample 推送到我们实验用的git服务器上。Maven构建时除了pom.xml<br>外还有一个重要的配置是 settings.xml 文件，一般在这个文件中指定私服 nexus<br>的地址，一般情况下会要求将这个文件放在本地用户家目录下的 .m2<br><a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E6%96%87%E4%BB%B6%E5%A4%B9-0.html">文件夹</a>中。但对Jenkins来说这样可能造成一个构建干扰另一个构建的情况，所以我们将这个<br>settings.xml 文件放在 javaMavenSample<br>项目的<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-%E6%A0%B9%E7%9B%AE%E5%BD%95-0.html">根目录</a>下一起提交。<br>现在创建一个新Job，名称就叫“project2_javaMavenSample-nightly”，类型选择“构建一个maven2/3项目”</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090635.png"></p>
</div>

<p>其他的设置参考前面监控检查的Job吧，这里只说说不一样的地方。<br>触发构建的日程表我们可以设置成“H 0 * *<br>*”，表示每天晚上0点检查代码库是否有更新。因为静态检查是一个极其消耗资源的缓慢过程，所以没有必要在健康检查中触发。<br>Maven项目的Job会有一个“Build”部分。“Goals and options”我们写“clean<br>install”，点击“高级”按钮展开高级属性，在“Settings<br>file”这里，选择“Settings file in<br>file<a target="_blank" rel="noopener" href="http://www.07net01.com/tags-system-0.html">system</a>”，“File<br>path”上可以写相对于Job工作区的相对路径，这里我们直接写“settings.xml”，这样代码库中随项目一起提交的settings.xml就会生效。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090636.png"></p>
</div>

<p>在“构建后操作”这部分，点击“Add post-build<br>action”按钮，添加“Sonar”，基本上安装默认值就可以。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090637.png"></p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090638.png"></p>
</div>

<p>执行Job看一下。<br>成功后到我们的Sonar服务器上可以看到结果 <a target="_blank" rel="noopener" href="http://172.16.12.83:9000//">http://172.16.12.83:9000/\</a><br><br><br><strong>创建自动部署测试环境的Job</strong><br><br>创建一个自动部署到测试环境的Job有很多方法。<br><br><strong>方法一：通过Deploy Plugin</strong><br><br>安装“Deploy Plugin”插件。这个插件支持<br><a target="_blank" rel="noopener" href="http://www.07net01.com/program/">Tomcat</a> 4.x/5.x/6.x/7.x、JBoss<br>3.x/4.x、Glassfish 2.x/3.x 的自动部署。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090639.png"><br><br>你可以在设置Job的“构建后操作”部分添加“Deploy war/ear to container”</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090640.png"></p>
</div>

<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090641.png"></p>
</div>

<p>要注意的是，比如你自动部署到 Tomcat 上，那么它的 webapps 目录下 manager<br>需要保留，然后在<br>conf/<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">tomcat</a>-users.xml<br>文件中，添加如下内容<br>                                                            </p>
<p><br><br>**方法二：通过<a target="_blank" rel="noopener" href="http://www.07net01.com/program/">脚本</a>**<br><br>这种方式更自由，你可以写好一个脚本来做你希望的事情，然后通过Jenkins来远程启动这个脚本。<br>如果时执行Windows下的批处理，就选择“Execute Windows batch<br>command”，如果是<a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">bash</a>脚本，就选择“Execute<br><a target="_blank" rel="noopener" href="http://www.07net01.com/linux/">shell</a>”。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090642.png"><br><br>写脚本时，有写Jenkins的内部变量你可以使用，比如我们这个实验系统，有个页面就是介绍这些内部变量的<br><a target="_blank" rel="noopener" href="http://ci.abc.com/jenkins/env-vars.html/%E3%80%82">http://ci.abc.com/jenkins/env-vars.html/。</a></p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090643.png"></p>
</div>

<p><strong>创建一个做集成测试的Job</strong><br><br>这一类的Job一般是依赖某个Job（比如手动部署测试环境）构建后启动构建。所以我们在配置Job属性时配置：</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090644.png"></p>
</div>

<p><strong>展示报告</strong><br><br>Jenkins<br>的插件已经覆盖了大部分的报告格式（测试报告、静态检查报告等），如果你使用了一个工具的报告格式是不常见。你可以尝试把格式转化为XUnit兼容的格式展示。或者可以将报告产生的XML文件结合<br>XLS文件通过 “HTML Publisher Plugin” 插件来展示。<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090645.png"><br><br>关于 XSL 展示 XML ，有兴趣可以看看<br><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/xml/theme/x-xsl.html/">http://www.ibm.com/developerworks/cn/xml/theme/x-xsl.html\</a><br><br><strong>交互风格的Job</strong><br><br>这是个有趣的功能，比如上面我们说的用于自动部署的Job，如果常规的构建方式，我们只能构建最新的代码，如果我们希望能部署指定的某次提交到测试环境怎么办呢？我们可以设置“参数化构建过程”来实现（参数化构建的本质是在构建前让你和Job有个交互过程，交互结果以环境变量方法参与到Job的构建）。<br>首选参考前文，在主节点上安装git工具并且配置访问git服务器的私钥（id_rsa）到<br>.ssh 目录下。<br>编辑Job的属性，找到“参数化构建过程”添加一个“Git Parameter”。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090646.png"></p>
</div>

<p>执行后发现并没有列出git上的所有提交。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090647.png"></p>
</div>

<p>在“系统管理”→“System Log”中<br><br><br><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090648.png"><br><br>查看“所有系统日志”得知，后台报错“No such file or<br>directory”。我觉得这是Jenkins的一个Bug，我们配置Job是在奴隶节点上执行，它却在主节点上查找目录。关于这个问题我们用另一个方法来解决，<strong>我们欣赏一下在主节点构建的Job使用Git参数做参数化构建的效果。有一点要注意，这里虽然列出提交Id但不代表选择后会签出指定的这次提交代码，它只是将你选择的内容保存到你指定Name命名的环境变量里。</strong></p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090649.png"></p>
</div>

<p>刚才说的另一个方法需要安装两个插件“Extended Choice Parameter<br>plugin”和“Extensible Choice Parameter<br>plugin”他们可以扩展参数化构建过程。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090650.png"></p>
</div>

<p>我们在 Jenkins 服务器上创建一个目录 /jenkins/tmp/，然后签出<br>javaMavenSample 项目的代码。<br>    [root svr80 ~]# mkdir /jenkins/tmp/[root svr80 ~]# cd /jenkins/tmp/[root svr80 tmp]# git clone ssh://git 172.16.12.83/home/git/git_home/javaMavenSample.git</p>
<p><br><br>在Jenkins的服务器上创建一个 /jenkins/tools/ 目录，然后在下面写一个脚本<br>genProject2Revision.sh，内容如下：<br>    #!/bin/bashcd /jenkins/tmp/javaMavenSample/usr/bin/git pullecho “revision=\“ &gt; /jenkins/tools/project2_revision.txt/usr/bin/git log –pretty=oneline | /bin/awk ‘{printf “%s,\\n”, $1}’ &gt;&gt; /jenkins/tools/project2_revision.txt</p>
<p><br><br>设置crontab 让这个脚本每小时执行一次。<br>    [root svr80 tools]# crontab -l0 * * * * /jenkins/tools/genProject2Revision.sh</p>
<p><br><br>这样我们每小时就会更新 project2_revision.txt 文件内容如下</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090651.png"></p>
</div>

<p>现在设置Job，添加“Extended Choice Parameter”</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090652.png"></p>
</div>

<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090653.png"></p>
</div>

<p>再执行Job，可以选择了</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090654.png"></p>
</div>

<p>这里做的选择只会将选择内容保存到 GIT_COMMIT<br>环境变量里，要希望签出选定的代码，创建一个Pre-build setup。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090655.png"></p>
</div>

<p>目前这个测试项目的提交历史如下</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090656.png"></p>
</div>

<p>当我选择中间的那次提交 ed8ec8bf4966cf41b859b5f60dd0fc96f5797af2<br>时，执行结果如下：</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090657.png"></p>
</div>

<p>当选择最早的那次提交 2f65720bb717c4e62ae9d2e34d521689e30cd463<br>时，执行结果如下，构建失败的原因参考上面的提交历史可知，那次提交时<br>settings.xml 文件还未添加。</p>
<div>

<p><img loading="lazy" src="/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob.resources/14110300819090658.png"></p>
</div>

<ul>
<li>查看<a target="_blank" rel="noopener" href="http://www.wredian.com/">图片</a>附件</li>
</ul>
</div>

</div>

</div>

<p>\</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/%E4%B8%93%E4%B8%9A%E6%8A%80%E6%9C%AF-%E5%8D%B0%E8%B1%A1%E7%AC%94%E8%AE%B0/">专业技术(印象笔记)</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/从印象笔记导入/">从印象笔记导入</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://clockcoder.com/2020/04/29/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob/" data-title="jenkins 重复执行job | 小黑的技术博客" data-tsina="1601653200" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2020/04/29/java相关理论技术收藏/" title="java相关理论技术收藏">
  <strong>上一篇：</strong><br/>
  <span>
  java相关理论技术收藏</span>
</a>
</div>


<div class="next">
<a href="/2020/04/29/javascript正则快速入门教程/"  title="javascript正则快速入门教程">
 <strong>下一篇：</strong><br/> 
 <span>javascript正则快速入门教程
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2020/04/29/jenkins 重复执行job/" data-title="jenkins 重复执行job" data-url="http://clockcoder.com/2020/04/29/jenkins%20%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob/"></div>
</section>


<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins-%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8Cjob"><span class="toc-number">1.</span> <span class="toc-text">jenkins 重复执行job</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jenkins%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C%E8%B0%884%EF%BC%88%E5%88%9B%E5%BB%BAJob%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Jenkins使用经验谈4（创建Job）</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="huguiqi" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AFNetWork3-1/" title="AFNetWork3.1">AFNetWork3.1<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Alcatraz/" title="Alcatraz">Alcatraz<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/IT-运维/" title="IT&amp;运维">IT&amp;运维<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/activiti/" title="activiti">activiti<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/AI/chatGPT/" title="chatGPT">chatGPT<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/devops/" title="devops">devops<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/rpc/dubbo/" title="dubbo">dubbo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/git/" title="git">git<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/github-博客/" title="github 博客">github 博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/hexo/" title="hexo">hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/hexo插件/" title="hexo插件">hexo插件<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios-Developer/" title="ios Developer">ios Developer<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/" title="java">java<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/javascript/" title="javascript">javascript<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/k8s/" title="k8s">k8s<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/kafka/" title="kafka">kafka<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/maven/" title="maven">maven<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/k8s/minikube/" title="minikube">minikube<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/node/" title="node">node<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nodejs/" title="nodejs">nodejs<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/kafka/nodejs/" title="nodejs">nodejs<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/postgresql/" title="postgresql">postgresql<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/rabbitMQ/" title="rabbitMQ">rabbitMQ<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/rabbitmq/" title="rabbitmq">rabbitmq<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/redis/" title="redis">redis<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/review/" title="review">review<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/rpc/" title="rpc">rpc<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springboot/skywalking/" title="skywalking">skywalking<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/sonarqube/" title="sonarqube">sonarqube<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springCloud/" title="springCloud">springCloud<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springboot/" title="springboot">springboot<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/activiti/springboot/" title="springboot">springboot<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springcloud/" title="springcloud">springcloud<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/xcode/" title="xcode">xcode<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/专业技术/" title="专业技术">专业技术<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/专业技术-印象笔记/" title="专业技术(印象笔记)">专业技术(印象笔记)<sup>222</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式/" title="分布式">分布式<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端技术/" title="前端技术">前端技术<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/加密解密/" title="加密解密">加密解密<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/区块链/加密货币/" title="加密货币">加密货币<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/区块链/" title="区块链">区块链<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/大数据/" title="大数据">大数据<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/延迟队列/" title="延迟队列">延迟队列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/感悟/" title="感悟">感悟<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/消息中间件/" title="消息中间件">消息中间件<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络/破解/" title="破解">破解<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/科学上网/" title="科学上网">科学上网<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/站内搜索-博客/" title="站内搜索 博客">站内搜索 博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/管理/" title="管理">管理<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统/" title="系统">系统<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-工具/" title="系统&amp;工具">系统&amp;工具<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-运维/" title="系统&amp;运维">系统&amp;运维<sup>34</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络/" title="网络">网络<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-运维/网络配置/" title="网络配置">网络配置<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络配置/" title="网络配置">网络配置<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/路由器/" title="路由器">路由器<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件规划/" title="软件规划">软件规划<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-运维/镜像/" title="镜像">镜像<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试/" title="面试">面试<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试整理/" title="面试整理">面试整理<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试题/" title="面试题">面试题<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/从印象笔记导入/" title="从印象笔记导入">从印象笔记导入<sup>222</sup></a></li>
			
		
			
				<li><a href="/tags/k8s/" title="k8s">k8s<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/springboot/" title="springboot">springboot<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/随笔/" title="随笔">随笔<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/redis/" title="redis">redis<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/hexo/" title="hexo">hexo<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/nodejs/" title="nodejs">nodejs<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/chatGPT/" title="chatGPT">chatGPT<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/spring-cloud/" title="spring cloud">spring cloud<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/面试题/" title="面试题">面试题<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Rejected/" title="Rejected">Rejected<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/rabbitMQ/" title="rabbitMQ">rabbitMQ<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/路由器/" title="路由器">路由器<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/nexus/" title="nexus">nexus<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ReactNative/" title="ReactNative">ReactNative<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/postgresql/" title="postgresql">postgresql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/jdk/" title="jdk">jdk<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://clockcoder.com" target="_blank" title="承接手机app、微信、web开发">找人做软件</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/64698454/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1601653200&verifier=bd864c6a&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Sam.This is my Blog. <br/>
			Anything that can go wrong will go wrong</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1601653200" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/huguiqi" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/XiaoheiSpring" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/sam.hu.7334" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/小黑-胡-ab83b992" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/64698454" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/hu-xiao-hei-53" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/109318125124422212783?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:guiqi.hu@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="http://blog.huguiqi.com." target="_blank" title="sam">sam</a> © 2023 
		
		<a href="/about" target="_blank" title="sam">sam</a>
		
		
		</p>
</div>

 <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','qtnHgvQyg5N9h4en-9wA','2.0.0');
</script>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"小黑_spring"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 


<script type="text/javascript">

var disqus_shortname = 'huguiqicom';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f5971877c7b77f98074be3ddabf34fbe";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
